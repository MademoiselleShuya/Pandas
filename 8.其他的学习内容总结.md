è¿™éƒ¨åˆ†çš„å†…å®¹ä½œä¸ºäº†è§£ï¼Œä¹‹åå¦‚æœç”¨åˆ°ï¼Œå†è¿”å›æ¥æŸ¥çœ‹ï¼Œé‡æ–°å­¦ä¹ 

å­¦ä¹ å†…å®¹

**pandasæ‰¹é‡æ‹†åˆ†äºå’Œåˆå¹¶excelæ–‡ä»¶**

1. å°†ä¸€ä¸ªå¤§çš„excelæ‹†åˆ†æˆå¤šä¸ªexcel

```
å·¥ä½œé€»è¾‘ï¼š
è®¡ç®—æ‹†åˆ†åçš„æ¯ä¸€ä¸ªexcelçš„è¡Œæ•°
æ‹†åˆ†æˆå¤šä¸ªdataframeï¼Œç”¨åˆ°ilocï¼Œappend
å°†æ¯ä¸ªdataframeå­˜å…¥excelï¼Œç”¨df.to_excel()
```

2. å°†å¤šä¸ªå°çš„excelåˆå¹¶æˆä¸€ä¸ªå¤§excelå¹¶æ ‡è®°æ¥æº

```
å·¥ä½œé€»è¾‘ï¼š
éå†æ–‡ä»¶å¤¹ï¼Œå¾—åˆ°è¦åˆå¹¶çš„excelæ–‡ä»¶åˆ—è¡¨(åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œæ”¾ç½®excelæ–‡ä»¶åï¼Œæ·»åŠ æ–‡ä»¶åappend)
åˆ†åˆ«è¯»å–åˆ°dataframeï¼Œæ¯ä¸ªdfæ·»åŠ ä¸€åˆ—ç”¨äºæ ‡è®°æ¥æº(åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œå­˜æ”¾å°çš„dataframeï¼Œç”¨appendæ·»åŠ ï¼Œä¿®æ”¹åç§°å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²çš„åˆ‡ç‰‡è¯­æ³•)
ä½¿ç”¨pd.concatè¿›è¡Œdfæ‰¹é‡åˆå¹¶
å°†åˆå¹¶çš„dataframeè¾“å…¥åˆ°excel
```

**pandasæ€æ ·å®ç°groupbyåˆ†ç»„æ•°æ®ç»Ÿè®¡**

ç±»ä¼¼SQLï¼š

Select city, max(temperature) from city_weather group by city

groupbyï¼šå…ˆå¯¹æ•°æ®åˆ†ç»„ï¼Œç„¶åå†æ¯ä¸ªåˆ†ç»„ä¸Šåº”ç”¨èšåˆå‡½æ•°ï¼Œè½¬æ¢å‡½æ•°

1. åˆ†ç»„ä½¿ç”¨èšåˆå‡½æ•°åšæ•°æ®ç»Ÿè®¡

```
å•ä¸ªåˆ—groupbyï¼ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®åˆ—çš„ç»Ÿè®¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šç”¨åˆ°pandasï¼Œnumpyï¼Œä»¥åŠ%matplotlib inline
dataFrame_Iwant.groupby("åˆ—åå­—").sum()
groupbyä¸­çš„é€‰ä¸­çš„åˆ—å˜æˆäº†æ•°æ®çš„ç´¢å¼•åˆ—ï¼›åŒæ—¶ç»Ÿè®¡sumï¼Œä¼šå°†ä¸æ˜¯æ•°å­—çš„åˆ—æ’é™¤åœ¨å¤–ï¼Œè‡ªåŠ¨å¿½ç•¥

å¤šä¸ªåˆ—groupbyï¼ŒæŸ¥è¯¢æ‰€æœ‰æ•°æ®åˆ—çš„ç»Ÿè®¡
dataFrame_Iwant.groupby("åˆ—åå­—1", "åˆ—åå­—2").mean()
æ­¤æ—¶"åˆ—åå­—1"ï¼Œ"åˆ—åå­—2"ï¼Œå˜æˆäº†äºŒçº§ç´¢å¼•ï¼Œå¦‚æœè®¾ç½®å‚æ•°ä¸ºas_index=Falseå°±ä¸ä¼šå˜æˆç´¢å¼•ï¼Œè€Œä»ä¸ºæ™®é€šçš„åˆ—

åŒæ—¶æŸ¥çœ‹å¤šç§æ•°æ®ç»Ÿè®¡
dataFrame_Iwant.groupby("åˆ—åå­—").agg([np.sum, np.mean, np.std])
è¿™æ—¶å€™åˆ—ç´¢å¼•ä¼šå˜æˆå¤šçº§ç´¢å¼•

æŸ¥çœ‹å•ä¸ªåˆ—çš„ç»“æœæ•°æ®ç»Ÿè®¡
dataFrame_Iwant.groupby("åˆ—åå­—1")["åˆ—åå­—2"].agg([np.sum, np.mean, np.std])
åœ¨groupbyä¹‹åå†ç­›é€‰å‡º"åˆ—åå­—2"åˆ—çš„æ•°æ®ç»Ÿè®¡ï¼Œè¿™ä¸ªæ—¶å€™å°±æ²¡æœ‰å¤šçº§ç´¢å¼•äº†
ä¹Ÿå¯ä»¥å†™æˆdataFrame_Iwant.groupby("åˆ—åå­—1").agg([np.sum, np.mean, np.std])["åˆ—åå­—2"]

ä¸åŒåˆ—ä½¿ç”¨ä¸åŒçš„èšåˆå‡½æ•°
dataFrame_Iwant.groupby("åˆ—åå­—1").agg({"åˆ—åå­—2":np.sum, "åˆ—åå­—3":np.mean})
```

2. éå†groupbyçš„ç»“æœç†è§£æ‰§è¡Œæµç¨‹

```
forå¾ªç¯å¯ä»¥ç›´æ¥éå†æ¯ä¸ªgroup
```

**pandasçš„åˆ†å±‚ç´¢å¼•multiIndexçš„ä½¿ç”¨**

åˆ†å±‚ç´¢å¼•ï¼šåœ¨ä¸€ä¸ªè½´ä¸Šæ‹¥æœ‰å¤šä¸ªç´¢å¼•å±‚çº§ï¼Œå¯ä»¥è¡¨è¾¾æ›´é«˜ç»´åº¦æ•°æ®çš„å½¢å¼

å¯ä»¥æ–¹ä¾¿è¿›è¡Œæ•°æ®ç­›é€‰ï¼Œå¦‚æœæœ‰åºæ€§èƒ½æ›´å¥½

groupbyç­‰æ“ä½œçš„ç»“æœï¼Œå¦‚æœæ˜¯å¤šKEYï¼Œç»“æœæ˜¯åˆ†å±‚ç´¢å¼•ï¼Œéœ€è¦ä¼šä½¿ç”¨

ä¸€èˆ¬ä¸éœ€è¦è‡ªå·±åˆ›å»ºåˆ†å±‚ç´¢å¼•ï¼ˆMultiIndexæœ‰æ„é€ å‡½æ•°ä½†ä¸€èˆ¬ä¸ç”¨ï¼‰

```
Seriesçš„åˆ†å±‚ç´¢å¼•MultiIndex
Series_Iwant.groupby(["A", "B"])["C"].mean()
å¤šå±‚ç´¢å¼•ä¸­ç©ºç™½æ˜¯æŒ‡ä½¿ç”¨ä¸Šé¢çš„å€¼
ser = Series_Iwant.groupby(["A", "B"])["C"].mean()
ser.index
ser.unstack() æŠŠå¤šçº§ç´¢å¼•å˜æˆåˆ—ï¼Œç›¸å½“äºser.reset_index()

Seriesæœ‰å¤šå±‚ç´¢å¼•æ€ä¹ˆæ ·ç­›é€‰æ•°æ®
ser.loc["ä¸€çº§ç´¢å¼•åå­—"]
ser.loc["ä¸€çº§ç´¢å¼•åå­—", "äºŒçº§ç´¢å¼•åå­—"]
ser.loc[:, "äºŒçº§ç´¢å¼•åå­—"]

DataFrameçš„å¤šå±‚ç´¢å¼•MultiIndex
DataFrame_Iwant.set_index(["ç´¢å¼•åå­—1", "ç´¢å¼•åå­—2"], inplace=True)

DataFrameæœ‰å¤šå±‚ç´¢å¼•æ€ä¹ˆæ ·ç­›é€‰æ•°æ®
åœ¨ä¼ å…¥æ•°æ®è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ï¼š
å…ƒç»„(key1, key2)ä»£è¡¨ç­›é€‰å¤šå±‚ç´¢å¼•ï¼Œå…¶ä¸­key1æ˜¯ä¸€çº§ç´¢å¼•ï¼Œkey2æ˜¯ç¬¬äºŒçº§
åˆ—è¡¨[key1, key2]ä»£è¡¨åŒä¸€å±‚ç´¢å¼•çš„å¤šä¸ªkeyï¼Œkey1å’Œkey2æ˜¯å¹¶åˆ—çš„åŒçº§ç´¢å¼•
DataFrame_Iwant.loc[(slice(None), ["key2.1", "key2.2"])]
(slice(None)ä»£è¡¨ç­›é€‰è¿™ä¸€ç´¢å¼•çš„æ‰€æœ‰å†…å®¹
DataFrame_Iwant.reset_index()
```

**pandasçš„è½¬æ¢å‡½æ•°mapã€applyã€applymap**

æ•°æ®è½¬æ¢å‡½æ•°å¯¹æ¯”ï¼šmapã€applyã€applymap

1. mapåªç”¨äºSeriesï¼Œå®ç°æ¯ä¸ªå€¼>å€¼çš„æ˜ å°„
2. applyç”¨Serieså®ç°æ¯ä¸ªå€¼çš„å¤„ç†ï¼Œç”¨äºDataframeå®ç°æŸä¸ªè½´çš„Seriesçš„å¤„ç†
3. applymapï¼šåªèƒ½ç”¨äºDataframeï¼Œç”¨äºå¤„ç†è¯¥Dataframeçš„æ¯ä¸ªå…ƒç´ 

```
mapç”¨äºSerieså€¼çš„è½¬æ¢
Series.map(dict) or Series.map(function)å‡å¯

applyç”¨äºSerieså’ŒDataFrame.çš„è½¬æ¢
Series.apply(function)ï¼Œå‡½æ•°çš„å‚æ•°æ˜¯æ¯ä¸€ä¸ªå€¼
DataFrame.apply(function)ï¼Œå‡½æ•°çš„å‚æ•°æ˜¯Series

applymapç”¨äºDataFrameæ‰€æœ‰å€¼çš„è½¬æ¢
DataFrame.applymap(function)
```

**pandaså¯¹æ¯ä¸ªåˆ†ç»„åº”ç”¨applyå‡½æ•°**

pandasçš„groupbyéµä»splitã€applyã€combineæ¨¡å¼

è¿™é‡Œçš„splitæ˜¯æŒ‡pandasçš„groupbyï¼Œæˆ‘ä»¬è‡ªå·±å®ç°applyå‡½æ•°ï¼Œapplyè¿”å›çš„ç»“æœç”±pandasè¿›è¡Œcombineå¾—åˆ°ç»“æœ

GroupBy.apply(function)

functionçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯dataframe

functionçš„è¿”å›ç»“æœï¼Œå¯æ˜¯dataframeã€seriesã€å•ä¸ªå€¼ã€ç”šè‡³å’Œè¾“å…¥dataframeå®Œå…¨æ²¡å…³ç³»

```
å®ç°å¯¹æ•°å€¼åˆ—æŒ‰åˆ†ç»„å½’ä¸€åŒ–
å°†ä¸åŒèŒƒå›´çš„æ•°å€¼è¿›è¡Œå½’ä¸€åŒ–ï¼Œæ˜ å°„åˆ°[0,1]åŒºé—´ï¼Œå¥½å¤„æ˜¯æ›´å®¹æ˜“åšæ•°æ®çš„æ¨ªå‘å¯¹æ¯”ï¼Œä»¥åŠæœºå™¨å­¦ä¹ æ¨¡å‹ä¼šå­¦çš„æ›´å¿«æ•ˆæœå’Œæ€§èƒ½ä¹Ÿå¯èƒ½æ›´å¥½
apply(å½’ä¸€åŒ–å…¬å¼)

å–æ¯ä¸ªåˆ†ç»„çš„TOPNæ•°æ®
apply(å–å¾—TOPNçš„å‡½æ•°ï¼Œå‚æ•°)
```

**pandasä½¿ç”¨stackå’Œpivotå®ç°æ•°æ®é€è§†**

å°†åˆ—å¼æ•°æ®å˜æˆäºŒç»´äº¤å‰å½¢å¼ï¼Œä¾¿äºåˆ†æï¼Œå«åšé‡å¡‘æˆ–é€è§†

```
ç»è¿‡ç»Ÿè®¡å¾—åˆ°å¤šç»´æŒ‡æ ‡æ•°æ®

ä½¿ç”¨unstackå®ç°æ•°æ®äºŒç»´é€è§†
DataFrame_Iwant_group.unstack()
unstackå’Œstackæ˜¯äº’é€†æ“ä½œ
df_group_stack.plot
unstackå°†indexè½¬æ¢æˆcolumnsï¼Œstackåä¹‹

ä½¿ç”¨pivotç®€åŒ–é€è§†
pivotç›¸å½“äºå¯¹DataFrameä½¿ç”¨set_indexåˆ›å»ºåˆ†å±‚ç´¢å¼•ï¼Œç„¶åè°ƒç”¨unstack

stackã€unstackã€pivotçš„è¯­æ³•
stack: DataFrame.stack(level=-1, dropna=True)ï¼Œå°†columnså˜æˆindexï¼Œç±»ä¼¼æŠŠæ¨ªæ”¾çš„ä¹¦ç±å˜æˆç«–æ”¾
level=-1ï¼Œä»£è¡¨å¤šå±‚ç´¢å¼•çš„æœ€å†…å±‚ï¼Œå¯ä»¥é€šè¿‡==0ã€1ã€2æŒ‡å®šå¤šå±‚ç´¢å¼•çš„å¯¹åº”å±‚
unstackï¼šDataFrame.unstack(level=-1, fill_value=None)æŠŠindexå˜æˆcolumnsï¼Œç›¸å½“äºæŠŠç«–æ”¾çš„ä¹¦ç±æ¨ªæ”¾
pivotï¼šDataFrame.pivot(index=None, columns=None, values=None)ï¼ŒæŒ‡å®šindexã€columnsã€valueså®ç°äºŒç»´é€è§†
```

**pandasä½¿ç”¨applyå‡½æ•°ç»™è¡¨æ ¼æ·»åŠ å¤šåˆ—**

```python
ç»™è¡¨æ ¼é¢˜æ·»åŠ ä¸€åˆ—ï¼š

def add_one_column(row)
	new_column = row["a"] + ["b"]
	return new_column

df["new_column"]=df.apply(add_one_colum, axis=1)


ç»™è¡¨æ ¼æ·»åŠ å¤šåˆ—

def add_columns(row)
	new_column1, new_column2 = row["a"] + ["b"], row["a"] - ["b"]
	return new_column1, new_column2

df[["new_column1", "new_column2"]]=df.apply(add_columns, axis=1, result_type="expand")

```



å­¦åğŸ¤®äº†ï¼Œè¿™ä¸¤å¤©ä¸æƒ³ç¢°pandasäº†ï¼ğŸ˜­ğŸ˜­